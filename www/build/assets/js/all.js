!function(e,t){var o=t.isDefined,r=t.isUndefined,n=t.isNumber,i=t.isObject,a=t.isArray,c=t.isString,s=t.extend,u=t.toJson;t.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/",secure:!1},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(e){return this.prefix=e,this},this.setStorageType=function(e){return this.storageType=e,this},this.setDefaultToCookie=function(e){return this.defaultToCookie=!!e,this},this.setStorageCookie=function(e,t,o){return this.cookie.expiry=e,this.cookie.path=t,this.cookie.secure=o,this},this.setStorageCookieDomain=function(e){return this.cookie.domain=e,this},this.setNotify=function(e,t){return this.notify={setItem:e,removeItem:t},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(e,t,l,d,f){function g(o){if(o||(o=t.event),v.setItem&&c(o.key)&&k(o.key)){var r=L(o.key);f(function(){e.$broadcast("LocalStorageModule.notification.changed",{key:r,newvalue:o.newValue,storageType:p.storageType})})}}var h,p=this,y=p.prefix,m=p.cookie,v=p.notify,S=p.storageType;l?l[0]&&(l=l[0]):l=document,"."!==y.substr(-1)&&(y=y?y+".":"");var T=function(e){return y+e},L=function(e){return e.replace(new RegExp("^"+y,"g"),"")},k=function(e){return 0===e.indexOf(y)},b=function(){try{var o=S in t&&null!==t[S],r=T("__"+Math.round(1e7*Math.random()));return o&&(h=t[S],h.setItem(r,""),h.removeItem(r)),o}catch(t){return p.defaultToCookie&&(S="cookie"),e.$broadcast("LocalStorageModule.notification.error",t.message),!1}},w=b(),C=function(t,o,n){if(R(n),o=r(o)?null:u(o),!w&&p.defaultToCookie||"cookie"===p.storageType)return w||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:"cookie"}),P(t,o);try{h&&h.setItem(T(t),o),v.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:p.storageType})}catch(r){return e.$broadcast("LocalStorageModule.notification.error",r.message),P(t,o)}return!0},O=function(t,o){if(R(o),!w&&p.defaultToCookie||"cookie"===p.storageType)return w||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),x(t);var r=h?h.getItem(T(t)):null;if(!r||"null"===r)return null;try{return JSON.parse(r)}catch(e){return r}},$=function(){var t=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(t=1,R(arguments[arguments.length-1]));var o,r;for(o=0;o<arguments.length-t;o++)if(r=arguments[o],!w&&p.defaultToCookie||"cookie"===p.storageType)w||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:r,storageType:"cookie"}),W(r);else try{h.removeItem(T(r)),v.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:r,storageType:p.storageType})}catch(t){e.$broadcast("LocalStorageModule.notification.error",t.message),W(r)}},E=function(t){if(R(t),!w)return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var o=y.length,r=[];for(var n in h)if(n.substr(0,o)===y)try{r.push(n.substr(o))}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.Description),[]}return r},I=function(t,o){R(o);var r=y?new RegExp("^"+y):new RegExp,n=t?new RegExp(t):new RegExp;if(!w&&p.defaultToCookie||"cookie"===p.storageType)return w||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),_();if(!w&&!p.defaultToCookie)return!1;var i=y.length;for(var a in h)if(r.test(a)&&n.test(a.substr(i)))try{$(a.substr(i))}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),_()}return!0},M=function(){try{return t.navigator.cookieEnabled||"cookie"in l&&(l.cookie.length>0||(l.cookie="test").indexOf.call(l.cookie,"test")>-1)}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),!1}}(),P=function(t,o,c,s){if(r(o))return!1;if((a(o)||i(o))&&(o=u(o)),!M)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var d="",f=new Date,g="";if(null===o?(f.setTime(f.getTime()+-864e5),d="; expires="+f.toGMTString(),o=""):n(c)&&0!==c?(f.setTime(f.getTime()+24*c*60*60*1e3),d="; expires="+f.toGMTString()):0!==m.expiry&&(f.setTime(f.getTime()+24*m.expiry*60*60*1e3),d="; expires="+f.toGMTString()),t){var h="; path="+m.path;m.domain&&(g="; domain="+m.domain),"boolean"==typeof s?s===!0&&(g+="; secure"):m.secure===!0&&(g+="; secure"),l.cookie=T(t)+"="+encodeURIComponent(o)+d+h+g}}catch(t){return e.$broadcast("LocalStorageModule.notification.error",t.message),!1}return!0},x=function(t){if(!M)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var o=l.cookie&&l.cookie.split(";")||[],r=0;r<o.length;r++){for(var n=o[r];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(T(t)+"=")){var i=decodeURIComponent(n.substring(y.length+t.length+1,n.length));try{var a=JSON.parse(i);return"number"==typeof a?i:a}catch(e){return i}}}return null},W=function(e){P(e,null)},_=function(){for(var e=null,t=y.length,o=l.cookie.split(";"),r=0;r<o.length;r++){for(e=o[r];" "===e.charAt(0);)e=e.substring(1,e.length);var n=e.substring(t,e.indexOf("="));W(n)}},A=function(){return S},R=function(e){return e&&S!==e&&(S=e,w=b()),w},D=function(e,t,r,n,a){n=n||t;var c=O(n,a);return null===c&&o(r)?c=r:i(c)&&i(r)&&(c=s(c,r)),d(t).assign(e,c),e.$watch(t,function(e){C(n,e,a)},i(e[t]))};w&&(t.addEventListener?(t.addEventListener("storage",g,!1),e.$on("$destroy",function(){t.removeEventListener("storage",g)})):t.attachEvent&&(t.attachEvent("onstorage",g),e.$on("$destroy",function(){t.detachEvent("onstorage",g)})));var N=function(e){R(e);for(var o=0,r=t[S],n=0;n<r.length;n++)0===r.key(n).indexOf(y)&&o++;return o};return{isSupported:w,getStorageType:A,setStorageType:R,set:C,add:C,get:O,keys:E,remove:$,clearAll:I,bind:D,deriveKey:T,underiveKey:L,length:N,defaultToCookie:this.defaultToCookie,cookie:{isSupported:M,set:P,add:P,get:x,remove:W,clearAll:_}}}]})}(window,window.angular),function(){var e=angular.module("ionic-app",["ionic","LocalStorageModule"]);e.config(["$httpProvider","localStorageServiceProvider",function(e,t){e.interceptors.push("APIInterceptor"),t.setPrefix("ionic-weather-app")}]),e.run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}])}(),function(){angular.module("ionic-app").controller("HomeController",["$scope","WeatherService","localStorageService",function(e,t,o){function r(){if(o.get("WeatherList")){var r=o.get("WeatherList");console.log(r),r.forEach(function(o){t.getWeatherByCity(o.city).then(function(t){e.WeatherList.push(t)})})}else t.getWeatherByGeoLocation().then(function(t){e.WeatherList.push(t),o.set("WeatherList",e.WeatherList)})}e.WeatherList=[],e.NewCityForm=!1,e.NewCity="",e.shouldShowDelete=!1,r(),e.addCity=function(){e.NewCityForm=!0},e.findCity=function(){t.getWeatherByCity(e.NewCity).then(function(t){t.name&&(e.City=t.name),e.WeatherList.push(t),e.NewCity="",e.NewCityForm=!1,o.set("WeatherList",e.WeatherList)})},e.removeWeather=function(t){console.log(t),e.WeatherList.splice(t,1),o.set("WeatherList",e.WeatherList)}}])}(),function(){angular.module("ionic-app").service("APIInterceptor",[function(){var e=0,t=this;return t.request=function(t){return e++,document.getElementById("layout").style.display="none",document.getElementById("loading").style.display="block",t},t.response=function(t){return e--,0==e&&(document.getElementById("layout").style.display="block",document.getElementById("loading").style.display="none"),t},t.responseError=function(e){return 401===e.status&&console.log("interceptor response error"),e},t}])}(),function(){angular.module("ionic-app").factory("WeatherService",["$http","$q",function(e,t){var o="e11af50148682cadb8b81ee1e1f1df4d",r="http://api.openweathermap.org/data/2.5/weather?units=metric&APPID="+o,n="http://openweathermap.org/img/w/",i={};return i.getIconUrl=function(e){return n+e+".png"},i.mapData=function(e){var t={};return t.temperature=e.main,t.icon=i.getIconUrl(e.weather[0].icon),t.description=e.weather[0].description,t.city=e.name,t},i.getWeatherByCity=function(o){var n=t.defer();return e({method:"GET",url:r+"&q="+o}).then(function(e){n.resolve(i.mapData(e.data))},function(e){n.reject(e)}),n.promise},i.getWeatherByGeoLocation=function(){var o=t.defer();return navigator.geolocation.getCurrentPosition(function(t){if(t){console.log(t);var n=t.coords.latitude,a=t.coords.longitude;e({method:"GET",url:r+"&lat="+n+"&lon="+a}).then(function(e){o.resolve(i.mapData(e.data))},function(e){o.reject(e)})}else o.resolve("location is not found!")}),o.promise},i}])}();